var App=function(){function t(){var t=$("#CityId").val(),o=$("#CityId").data("district");$.get(AppConstants.UrlGetDistricts(t),function(t){if(0===t.length)$(".pdistrict").hide(),$("#DistrictId").html("");else{$(".pdistrict").show();for(var n="",a=0;a<t.length;a++){var e="";o===t[a].id&&(e+="selected=selected"),n+='<option value="'+t[a].id+'" '+e+">"+t[a].name+"</option>"}$("#DistrictId").html(n)}})}return{Init:function(){setTimeout(function(){AppSettings.IsAuthenticated&&AppNotification.Init()},500),function(){$('[data-toggle="tooltip"]').tooltip(),$(".campaign-image-carousel").owlCarousel({margin:10,items:1,autoHeight:!0}),$(".fbpost-carousel").owlCarousel({margin:10,items:4}),$(".btn-remotemodal").click(function(){var t=$(this).data("url");AppBsModal.Init(),AppBsModal.OpenRemoteModal(t,function(){})}),$(".image-upload").change(function(){var t=$(this).attr("id"),n=$(this).data("target"),a=$(this).data("preview"),e=document.getElementById(t).files;AppCommon.uploadTempImage(e,function(t){0<t.length&&($(n).val(t[0].path),$(n).trigger("change"),$(a).attr("src",t[0].url))})}),$(".form-select2").select2({theme:"bootstrap4"}),$(".form-select2-tags").select2({theme:"bootstrap4",tags:!0,tokenSeparators:[","]}),$(".form-datepicker").daterangepicker({singleDatePicker:!0,showDropdowns:!0,autoApply:!0,locale:{format:"DD/MM/YYYY"}}),$(".form-datetimepicker").daterangepicker({singleDatePicker:!0,timePicker:!0,autoApply:"true",showDropdowns:!0,locale:{format:"hh:mm A DD/MM/YYYY"}},function(t,n,a){moment().diff(t,"years")}),$(".form-daterangepicker").daterangepicker({autoUpdateInput:!1,locale:{format:"DD/MM/YYYY"}},function(t,n,a){moment().diff(t,"years")}),0<$("#CityId").length&&(t(),setTimeout(function(){$("#CityId").change(function(){console.log("CityId change-"),t()})},500));0<$("#cookieConsentModal").length&&$("#cookieConsentModal").modal("show");$.extend($.validator.messages,{required:"Hãy nhập.",remote:"Hãy sửa cho đúng.",email:"Hãy nhập email.",url:"Hãy nhập URL.",date:"Hãy nhập ngày.",dateISO:"Hãy nhập ngày (ISO).",number:"Hãy nhập số.",digits:"Hãy nhập chữ số.",creditcard:"Hãy nhập số thẻ tín dụng.",equalTo:"Hãy nhập thêm lần nữa.",extension:"Phần mở rộng không đúng.",maxlength:$.validator.format("Hãy nhập từ {0} kí tự trở xuống."),minlength:$.validator.format("Hãy nhập từ {0} kí tự trở lên."),rangelength:$.validator.format("Hãy nhập từ {0} đến {1} kí tự."),range:$.validator.format("Hãy nhập từ {0} đến {1}."),max:$.validator.format("Hãy nhập từ {0} trở xuống."),min:$.validator.format("Hãy nhập từ {0} trở lên.")})}(),function(){var t=$("#CurrentPage").val();"account_changeaccounttype"===t?ChangeAccountTypePage.Init():"account_fbaccount"===t?AccountFbAccountPage.Init():"campaign_details"===t?CampaignDetailsPage.Init():"campaign_index"===t?CampaignIndexPage.Init():"home_index"===t?HomeIndexPage.Init():"account_index"===t&&AccountIndexPage.Init()}()}}}(),AppCommon={loadScrollTop:function(){$(window).scroll(function(){500<$(this).scrollTop()?$("#stickyFooterActions").fadeIn():$("#stickyFooterActions").fadeOut()}),$("#scrollToTop").click(function(){$("html, body").animate({scrollTop:0},800)})},handlerBtnReload:function(){$(".btn-reload").click(function(t){window.location=window.location})},uploadTempImage:function(t,n){var a,e;(a=new XMLHttpRequest).withCredentials=!1,a.open("POST",AppConstants.UrlUploadTempImage),a.onload=function(){if(200===a.status){var t=JSON.parse(a.responseText);n(t)}else failure("HTTP Error: "+a.status)},e=new FormData;for(var o=0;o<t.length;o++)e.append("files",t[o]);a.send(e)},bindingWalletBalance:function(){$.get(AppConstants.UrlGetAmount,function(t){$(".wallet-balance").html(AppCommon.moneyFormat(t)),AppSettings.CurrentUser.Balance=t})},moneyFormat:function(t,n,a){var e="\\d(?=(\\d{"+(a||3)+"})+"+(0<n?"\\.":"$")+")";return t.toFixed(Math.max(0,~~n)).replace(new RegExp(e,"g"),"$&,")+" đ"},toggleAffix:function(){function a(t,n,a){var e=t.outerHeight(),o=a.offset().top;n.scrollTop()>=o?(a.height(e),t.addClass("affix")):(t.removeClass("affix"),a.height("auto"))}$('[data-toggle="affix"]').each(function(){var t=$(this),n=$("<div></div>");t.before(n),$(window).on("scroll resize",function(){a(t,$(this),n)}),a(t,$(window),n)})}},AppConstants={UrlUploadFile:"/home/uploadimage",UrlGetAmount:"/wallet/GetAmount",UrlRecharge:function(t){return"/wallet/Recharge?campaignid="+(t=t||0)},UrlWithdraw:"/wallet/Withdraw",UrlGetNotificationCount:"/Notification/Count",UrlUpdateNotificationChecked:"/Notification/UpdateChecked",UrlGetNotification:"/Notification/IndexPartial",UrlUploadTempImage:"/Home/UploadImage",UrlGetAccounts:"/AgencyCampaign/GetAccounts",UrlGetDistricts:function(t){return"/home/GetDistricts?cityid="+t},UrlAgencyPayment:function(t){return"/AgencyPayment/CampaignPayment?campaignid="+t},ModalSpinner:'<div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="py-5 text-center text-success loading"><i class="fas fa-spinner fa-spin"></i></div> </div></div>',HtmlSpinner:'<div class="py-5 text-center text-success loading"><i class="fas fa-spinner fa-spin"></i></div>'},AppSettings={IsAuthenticated:!1,CurrentUser:{Username:"",Name:"",Type:-1,Balance:0}},AppBsModal=function(){var a="#appbsmodal";function e(){$(a).html(AppConstants.ModalSpinner),$(a).modal("show")}function o(){$(a).remove()}return{Init:function(t){o(),void 0===t&&(t=!0);var n='<div id="appbsmodal" class="modal" data-backdrop="'+t+'"></div>';$("body").append(n),$(a).on("hidden.bs.modal",function(t){o()})},OpenModal:function(t,n){$(a).html(t),n&&"function"==typeof n&&n(),$(a).modal("show")},OpenRemoteModal:function(t,n){e(),$(a).modal("show"),$.get(t,function(t){$(a).html(t),n&&"function"==typeof n&&n()})},ShowLoading:e,HideModal:function(){$(a).modal("hide"),$(a).remove()}}}(),AppNotification=function(){var a=$(".nav-notif .badge"),n=$(".nav-notif .dropdown-menu");function e(){$.get(AppConstants.UrlGetNotification,function(t){n.html(t)})}return{Init:function(){e(),$(".nav-notif").on("show.bs.dropdown",function(){$.post(AppConstants.UrlUpdateNotificationChecked,function(){$(".nav-notif .badge").hide(),$(".nav-notif .badge").text("0")})}),function(){var n=parseInt(a.text());$.get(AppConstants.UrlGetNotificationCount,function(t){a.text(t),0===t?$(".nav-notif .badge").hide():$(".nav-notif .badge").show(),t!==n&&e()})}()}}}(),AppPayment={Init:function(){$(".btn-payment").click(function(t){t.preventDefault();var n=$(this).data("id");AppBsModal.Init("static"),AppBsModal.OpenRemoteModal(AppConstants.UrlAgencyPayment(n))})},HandlerPayment:function(){$.validator.unobtrusive.parse($("#frmPayment")),$("#frmPayment").submit(function(t){if(t.preventDefault(),$(this).valid()){var n=$(this).data("action"),a=$(this).serialize();AppBsModal.ShowLoading(),$.post(n,a,function(t){AppBsModal.OpenModal(t)})}})},HandlerMessage:function(){AppCommon.handlerBtnReload()}},AppWallet=function(){function a(){$.validator.unobtrusive.parse($("#frmRecharge")),$("#frmRecharge").submit(function(t){if(t.preventDefault(),$(this).valid()){var n=$(this).data("action"),a=$(this).serialize();AppBsModal.ShowLoading(),$.post(n,a,function(t){AppBsModal.OpenModal(t)})}}),n(),$('#frmRecharge input[name="Method"]').change(function(){n()}),t(),$("#Bank").change(function(){t()})}function t(){$(".bankinfo").addClass("d-none");var t=$("#Bank").val();$("#bankinfo"+t).removeClass("d-none")}function n(){var t=$('#frmRecharge input[name="Method"]:checked').val();console.log("handlerMethod",t),"Chuyển khoản"===t?$("#bankWrap").removeClass("d-none"):$("#bankWrap").addClass("d-none")}return{Init:function(){$(".wallet-recharge").click(function(t){var n=$(this).data("campaignid");t.preventDefault(),AppBsModal.Init(),AppBsModal.OpenRemoteModal(AppConstants.UrlRecharge(n),function(){a()})}),$(".wallet-withdraw").click(function(t){t.preventDefault(),AppBsModal.Init(),AppBsModal.OpenRemoteModal(AppConstants.UrlWithdraw,function(){$.validator.unobtrusive.parse($("#frmWithDraw")),$("#frmWithDraw").submit(function(t){if(t.preventDefault(),$(this).valid()){var n=$(this).data("action"),a=$(this).serialize();AppBsModal.ShowLoading(),$.post(n,a,function(t){AppBsModal.OpenModal(t)})}})})})},HandlerRecharge:a}}(),AccountFbAccountPage={Init:function(){FB.getLoginStatus(function(t){console.log("getLoginStatus",t),"connected"===t.status?(t.authResponse.userID,t.authResponse.accessToken,FB.api("/me?fields=friends.limit(40){id,link,name}",function(t){console.log("loadfriend",t),t.friends&&0<t.friends.data.length&&($(".accountfriendSection").html(""),t.friends.data.forEach(function(t){console.log("friends",t);var n=$("#item"+t.id);0<n.length&&$(".accountfriendSection").append('<div class="col-md-3">'+n.html()+"</div>")}),$(".kolfriend-count").html(""+t.friends.data.length),$(".friends-count").html("/ "+t.friends.summary.total_count+" bạn bè trên Facebook"))})):t.status})}},AccountFbPost={Init:function(){$(".btn-updateFbPost").click(function(t){t.preventDefault(),FB.login(function(t){if("connected"===t.status){var n=t.authResponse.accessToken;$("#frmUpdatefbpostToken").val(n),$("#frmUpdatefbpost").submit()}else alert("Bạn cần cập nhật quyền trên hệ thống của Facebook")},{scope:"user_posts"})})}},AccountIndexPage={Init:function(){FB.getLoginStatus(function(t){console.log("getLoginStatus",t),"connected"===t.status?(t.authResponse.userID,t.authResponse.accessToken,FB.api("/me?fields=friends.limit(10){id,link,name}",function(t){console.log("loadfriend",t)})):t.status})}},CampaignDetailsPage=function(){function t(){$(".btn-updateref").click(function(){var t=$(this).data("url");AppBsModal.Init("static"),AppBsModal.OpenRemoteModal(t,function(){$.validator.unobtrusive.parse($("#frmUpdateCampaignAccountRef")),$("#frmUpdateCampaignAccountRef").submit(function(t){if(t.preventDefault(),$(this).valid()){var n=$(this).data("action"),a=$(this).serialize();AppBsModal.ShowLoading(),$.post(n,a,function(t){AppBsModal.OpenModal(t,function(){AppCommon.handlerBtnReload()})})}})})}),$(".btn-updaterefimages").click(function(){var t=$(this).data("url");AppBsModal.Init("static"),AppBsModal.OpenRemoteModal(t,function(){$.validator.unobtrusive.parse($("#frmUpdateCampaignAccountRefImages")),$("#addonImages").change(function(){var t=$(this).attr("id"),a=$(this).data("target"),n=document.getElementById(t).files;AppCommon.uploadTempImage(n,function(t){t.forEach(function(t){var n='<img src="'+t.url+'"  class="img-thumbnail mt-2" style="max-height:400px" /><input type="hidden" name="RefImage" value="'+t.path+'" />';$(a).append(n)})})}),$("#frmUpdateCampaignAccountRefImages").submit(function(t){if(t.preventDefault(),$(this).valid()){var n=$(this).data("action"),a=$(this).serialize();AppBsModal.ShowLoading(),$.post(n,a,function(t){AppBsModal.OpenModal(t,function(){AppCommon.handlerBtnReload()})})}})})}),$(".btn-shareui").click(function(){AppBsModal.Init("static"),AppBsModal.OpenModal(""),AppBsModal.ShowLoading();var t=$(this).data("href"),n=$(this).data("urlsubmit"),a=$(this).data("title"),e=$(this).data("picture"),o=$(this).data("description"),i=$(this).data("caption");FB.ui({method:"share",href:t,title:a,picture:e,caption:i,description:o},function(t){t&&!t.error_message?$.post(n,function(t){AppBsModal.OpenModal(t,function(){AppCommon.handlerBtnReload()})}):AppBsModal.HideModal()})})}return{Init:function(){t(),$("#chartModel").length},HandlerAction:t}}(),CampaignIndexPage={Init:function(){CampaignDetailsPage.HandlerAction()}},ChangeAccountTypePage=function(){function t(){"HotMom"===$("input[name=Type]:checked").val()?$("#dataHotMom").removeClass("d-none"):$("#dataHotMom").addClass("d-none")}return{Init:function(){t(),$("input[name=Type]").change(function(){t()}),$(".checkbox-ignorecampaigntype").change(function(){var t=$(this).data("url");$.post(t,function(){})})}}}(),HomeIndexPage={Init:function(){$(".owl-carousel").owlCarousel({margin:10,loop:!0,autoWidth:!0,items:4}),$("#main").css("min-height","0")}};$().ready(function(){var t=$("#FbAppId").val();$.ajax({type:"GET",url:"https://connect.facebook.net/en_US/sdk.js",success:function(){FB.init({appId:t,version:"v4.0"}),App.Init()},dataType:"script",cache:!0})});