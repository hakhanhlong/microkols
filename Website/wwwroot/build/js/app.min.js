var App=function(){function n(){var n=$("#CityId").val(),o=$("#CityId").data("district");$.get(AppConstants.UrlGetDistricts(n),function(n){if(0===n.length)$(".pdistrict").hide(),$("#DistrictId").html("");else{$(".pdistrict").show();for(var t="",a=0;a<n.length;a++){var e="";o===n[a].id&&(e+="selected=selected"),t+='<option value="'+n[a].id+'" '+e+">"+n[a].name+"</option>"}$("#DistrictId").html(t)}})}return{Init:function(){setTimeout(function(){AppSettings.IsAuthenticated&&(AppCommon.bindingWalletBalance(),AppNotification.Init(),AppWallet.Init(),2===AppSettings.CurrentUser.Type&&AppPayment.Init())},500),function(){$('[data-toggle="tooltip"]').tooltip(),$(".btn-facebook").click(function(){var t=$($(this).data("target"));FB.login(function(n){console.log("login-facebook",n),"connected"===n.status&&(t.find("input[name=token]").val(n.authResponse.accessToken),t.submit())},{scope:"public_profile,email,user_likes,user_friends,user_link,user_posts"})}),$(".btn-linkfacebook").click(function(){var t=$($(this).data("target"));FB.login(function(n){console.log("login-facebook",n),"connected"===n.status&&(t.find("input[name=token]").val(n.authResponse.accessToken),t.submit())},{scope:"public_profile,email,user_likes,user_friends,user_link,user_posts"})}),$(".btn-remotemodal").click(function(){var n=$(this).data("url");AppBsModal.Init(),AppBsModal.OpenRemoteModal(n,function(){})}),$(".image-upload").change(function(){var n=$(this).attr("id"),t=$(this).data("target"),a=$(this).data("preview"),e=document.getElementById(n).files;AppCommon.uploadTempImage(e,function(n){0<n.length&&($(t).val(n[0].path),$(t).trigger("change"),$(a).attr("src",n[0].url))})}),$(".form-select2").select2({theme:"bootstrap4"}),$(".form-datepicker").daterangepicker({singleDatePicker:!0,showDropdowns:!0,locale:{format:"DD/MM/YYYY"}},function(n,t,a){moment().diff(n,"years")}),0<$("#CityId").length&&(n(),setTimeout(function(){$("#CityId").change(function(){console.log("CityId change-"),n()})},500));AppCommon.toggleAffix(),0<$("#cookieConsentModal").length&&$("#cookieConsentModal").modal("show");$.extend($.validator.messages,{required:"Hãy nhập.",remote:"Hãy sửa cho đúng.",email:"Hãy nhập email.",url:"Hãy nhập URL.",date:"Hãy nhập ngày.",dateISO:"Hãy nhập ngày (ISO).",number:"Hãy nhập số.",digits:"Hãy nhập chữ số.",creditcard:"Hãy nhập số thẻ tín dụng.",equalTo:"Hãy nhập thêm lần nữa.",extension:"Phần mở rộng không đúng.",maxlength:$.validator.format("Hãy nhập từ {0} kí tự trở xuống."),minlength:$.validator.format("Hãy nhập từ {0} kí tự trở lên."),rangelength:$.validator.format("Hãy nhập từ {0} đến {1} kí tự."),range:$.validator.format("Hãy nhập từ {0} đến {1}."),max:$.validator.format("Hãy nhập từ {0} trở xuống."),min:$.validator.format("Hãy nhập từ {0} trở lên.")})}(),function(){var n=$("#CurrentPage").val();"account_changeaccounttype"===n?ChangeAccountTypePage.Init():"agencycampaign_create"===n?AgencyCreateCampaignPage.Init():"agencycampaign_details"===n?AgencyDetailsCampaignPage.Init():"accountcampaign_details"===n?AccountDetailsCampaignPage.Init():"home_index"===n&&HomeIndexPage.Init()}()}}}(),AppCommon={loadScrollTop:function(){$(window).scroll(function(){500<$(this).scrollTop()?$("#stickyFooterActions").fadeIn():$("#stickyFooterActions").fadeOut()}),$("#scrollToTop").click(function(){$("html, body").animate({scrollTop:0},800)})},handlerBtnReload:function(){$(".btn-reload").click(function(n){window.location=window.location})},uploadTempImage:function(n,t){var a,e;(a=new XMLHttpRequest).withCredentials=!1,a.open("POST",AppConstants.UrlUploadTempImage),a.onload=function(){if(200===a.status){var n=JSON.parse(a.responseText);t(n)}else failure("HTTP Error: "+a.status)},e=new FormData;for(var o=0;o<n.length;o++)e.append("files",n[o]);a.send(e)},bindingWalletBalance:function(){$.get(AppConstants.UrlGetAmount,function(n){$(".wallet-balance").html(AppCommon.moneyFormat(n)),AppSettings.CurrentUser.Balance=n})},moneyFormat:function(n,t,a){var e="\\d(?=(\\d{"+(a||3)+"})+"+(0<t?"\\.":"$")+")";return n.toFixed(Math.max(0,~~t)).replace(new RegExp(e,"g"),"$&,")+" đ"},toggleAffix:function(){function a(n,t,a){var e=n.outerHeight(),o=a.offset().top;t.scrollTop()>=o?(a.height(e),n.addClass("affix")):(n.removeClass("affix"),a.height("auto"))}$('[data-toggle="affix"]').each(function(){var n=$(this),t=$("<div></div>");n.before(t),$(window).on("scroll resize",function(){a(n,$(this),t)}),a(n,$(window),t)})}},AppConstants={UrlUploadFile:"/home/uploadimage",UrlGetAmount:"/wallet/GetAmount",UrlRecharge:function(n){return"/wallet/Recharge?campaignid="+(n=n||0)},UrlWithdraw:"/wallet/Withdraw",UrlGetNotificationCount:"/Notification/Count",UrlUpdateNotificationChecked:"/Notification/UpdateChecked",UrlGetNotification:"/Notification/IndexPartial",UrlUploadTempImage:"/Home/UploadImage",UrlGetDistricts:function(n){return"/home/GetDistricts?cityid="+n},UrlAgencyPayment:function(n){return"/AgencyPayment/CampaignPayment?campaignid="+n},ModalSpinner:'<div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="py-5 text-center text-success loading"><i class="fas fa-spinner fa-spin"></i></div> </div></div>'},AppSettings={IsAuthenticated:!1,CurrentUser:{Username:"",Name:"",Type:-1,Balance:0}},AppBsModal=function(){var a="#appbsmodal";function e(){$(a).html(AppConstants.ModalSpinner),$(a).modal("show")}function o(){$(a).remove()}return{Init:function(n){o(),void 0===n&&(n=!0);var t='<div id="appbsmodal" class="modal" data-backdrop="'+n+'"></div>';$("body").append(t),$(a).on("hidden.bs.modal",function(n){o()})},OpenModal:function(n,t){$(a).html(n),t&&"function"==typeof t&&t(),$(a).modal("show")},OpenRemoteModal:function(n,t){e(),$(a).modal("show"),$.get(n,function(n){$(a).html(n),t&&"function"==typeof t&&t()})},ShowLoading:e,HideModal:function(){$(a).modal("hide"),$(a).remove()}}}(),AppNotification=function(){var a=$(".nav-notif .badge"),t=$(".nav-notif .dropdown-menu");function e(){$.get(AppConstants.UrlGetNotification,function(n){t.html(n)})}return{Init:function(){e(),$(".nav-notif").on("show.bs.dropdown",function(){$.post(AppConstants.UrlUpdateNotificationChecked,function(){$(".nav-notif .badge").hide(),$(".nav-notif .badge").text("0")})}),function(){var t=parseInt(a.text());$.get(AppConstants.UrlGetNotificationCount,function(n){a.text(n),0===n?$(".nav-notif .badge").hide():$(".nav-notif .badge").show(),n!==t&&e()})}()}}}(),AppPayment={Init:function(){$(".btn-payment").click(function(n){n.preventDefault();var t=$(this).data("id");AppBsModal.Init("static"),AppBsModal.OpenRemoteModal(AppConstants.UrlAgencyPayment(t))})},HandlerPayment:function(){$.validator.unobtrusive.parse($("#frmPayment")),$("#frmPayment").submit(function(n){if(n.preventDefault(),$(this).valid()){var t=$(this).data("action"),a=$(this).serialize();AppBsModal.ShowLoading(),$.post(t,a,function(n){AppBsModal.OpenModal(n)})}})},HandlerMessage:function(){AppCommon.handlerBtnReload()}},AppWallet=function(){function t(){$.validator.unobtrusive.parse($("#frmRecharge")),$("#frmRecharge").submit(function(n){if(n.preventDefault(),$(this).valid()){var t=$(this).data("action"),a=$(this).serialize();AppBsModal.ShowLoading(),$.post(t,a,function(n){AppBsModal.OpenModal(n)})}}),a(),$('#frmRecharge input[name="Method"]').change(function(){a()}),n(),$("#Bank").change(function(){n()})}function n(){$(".bankinfo").addClass("d-none");var n=$("#Bank").val();$("#bankinfo"+n).removeClass("d-none")}function a(){var n=$('#frmRecharge input[name="Method"]:checked').val();console.log("handlerMethod",n),"Chuyển khoản"===n?$("#bankWrap").removeClass("d-none"):$("#bankWrap").addClass("d-none")}return{Init:function(){$(".wallet-recharge").click(function(n){n.preventDefault(),AppBsModal.Init(),AppBsModal.OpenRemoteModal(AppConstants.UrlRecharge(),function(){t()})}),$(".wallet-withdraw").click(function(n){n.preventDefault(),AppBsModal.Init(),AppBsModal.OpenRemoteModal(AppConstants.UrlWithdraw,function(){$.validator.unobtrusive.parse($("#frmWithDraw")),$("#frmWithDraw").submit(function(n){if(n.preventDefault(),$(this).valid()){var t=$(this).data("action"),a=$(this).serialize();AppBsModal.ShowLoading(),$.post(t,a,function(n){AppBsModal.OpenModal(n)})}})})})},HandlerRecharge:t}}(),AccountDetailsCampaignPage={Init:function(){$(".btn-updateref").click(function(){var n=$(this).data("url");AppBsModal.Init("static"),AppBsModal.OpenRemoteModal(n,function(){$.validator.unobtrusive.parse($("#frmUpdateCampaignAccountRef")),$("#frmUpdateCampaignAccountRef").submit(function(n){if(n.preventDefault(),$(this).valid()){var t=$(this).data("action"),a=$(this).serialize();AppBsModal.ShowLoading(),$.post(t,a,function(n){AppBsModal.OpenModal(n,function(){AppCommon.handlerBtnReload()})})}})})}),$(".btn-shareui").click(function(){AppBsModal.Init("static"),AppBsModal.OpenModal(""),AppBsModal.ShowLoading();var n=$(this).data("href"),t=$(this).data("urlsubmit");FB.ui({method:"share",href:n},function(n){n&&!n.error_message?$.post(t,function(n){AppBsModal.OpenModal(n,function(){AppCommon.handlerBtnReload()})}):AppBsModal.HideModal()})})}},AgencyCreateCampaignPage=function(){function n(t){var n=$("#frmCreateCampaign");if(console.log("createCampaign"),n.valid()){AppBsModal.Init("static"),AppBsModal.ShowLoading();var a=n.data("action"),e=n.serialize();$.post(a,e,function(n){-1==n.status?(AppBsModal.HideModal(),$.notify({message:n.message,type:"danger"})):t(n)})}}function t(){var n=$("#Type").val();console.log("type",n),$("#enabledExtraTypeWrap,#requirementWrap,#changeAvatarWrap").addClass("d-none");var t=$("#Type").children("option:selected"),a=t.data("accountpricetext"),e=t.data("datatext");$("#dataText").text(e),"ChangeAvatar"===n?($("#dataInput").addClass("d-none"),$("#dataImage").removeClass("d-none")):($("#dataInput").removeClass("d-none"),$("#dataImage").addClass("d-none")),$("#editAccountPriceWrap span").text(a),$("#editAccountPriceWrap").removeClass("openedit"),"ShareContent"===n||"ShareContentWithCaption"===n?$("#enabledExtraTypeWrap").removeClass("d-none"):"CustomService"===n?($("#requirementWrap").removeClass("d-none"),$("#editAccountPriceWrap").addClass("openedit")):"JoinEvent"===n?$("#editAccountPriceWrap").addClass("openedit"):"ChangeAvatar"===n&&$("#changeAvatarWrap").removeClass("d-none"),o()}function o(){var n=$("#Type").val(),t=$("#Type").children("option:selected"),a=t.data("serviceprice");t.data("accountprice"),t.data("accountextrapricepercent");"CustomService"!==n&&"JoinEvent"!==n||$("#AccountPrice").val();$("#NumberOfAccount").val();var e=a+$("#campaignOptions .form-option:checked").length*$("#settingExtraOptionCharge").val()*a/100,o=e*$("#settingServiceCharge").val()/100,i=e+o;$("#totalServicePrice").text(AppCommon.moneyFormat(e)),$("#serviceCharge").text(AppCommon.moneyFormat(o)),$("#totalServiceCharge").text(AppCommon.moneyFormat(i)),setTimeout(function(){AppSettings.CurrentUser.Balance<=i?($("#btnCreateCampaignRecharge").show(),$("#btnCreateCampaign").hide()):($("#btnCreateCampaignRecharge").hide(),$("#btnCreateCampaign").show())},1e3)}return{Init:function(){$("#dataImageFile").change(function(){var n=$(this).attr("id"),t=$(this).data("target"),a=$(this).data("preview"),e=document.getElementById(n).files;AppCommon.uploadTempImage(e,function(n){0<n.length&&($(t).val(n[0].path),$(t).trigger("change"),$(a).attr("src",n[0].url))})}),$("#btnCreateCampaign").click(function(){$("#submittype").val(1),n(function(n){setTimeout(function(){window.location=n.url},1e3)})}),$("#btnCreateCampaignRecharge").click(function(){$("#submittype").val(0),n(function(n){AppBsModal.OpenRemoteModal(AppConstants.UrlRecharge(n.campaignid),function(){AppWallet.HandlerRecharge()})})}),t(),$("#Type").change(function(){t()}),$("#campaignOptions .form-option").change(function(){o()})}}}(),AgencyDetailsCampaignPage=function(){function i(t){$(".btn-reload").unbind("click"),$(".btn-reload").click(function(n){t?window.location=window.location:AppBsModal.HideModal()})}return{Init:function(){$(".btn-campaignaccount").click(function(){var n=$(this).data("url");AppBsModal.Init("static"),AppBsModal.OpenRemoteModal(n,function(){$(".frm-requestjoin").submit(function(){var n=$(this),t=n.serialize(),a=n.data("action"),e=n.find(".btn-requestjoin"),o=e.find("i");e.prop("disabled",!0),o.removeClass("fa-plus").addClass("fa-spinner fa-spin"),$.post(a,t,function(n){1==n?(e.removeClass("btn-outline-primary").addClass("btn-outline-success"),o.removeClass("fa-spinner fa-spin").addClass("fa-check")):(e.prop("disabled",!1),e.removeClass("btn-outline-primary").addClass("btn-outline-danger"),o.removeClass("fa-spinner fa-spin").addClass("fa-plus")),i(!0)})}),i()})})}}}(),ChangeAccountTypePage=function(){function n(){"HotMom"===$("input[name=Type]:checked").val()?$("#dataHotMom").removeClass("d-none"):$("#dataHotMom").addClass("d-none")}return{Init:function(){n(),$("input[name=Type]").change(function(){n()}),$(".checkbox-ignorecampaigntype").change(function(){var n=$(this).data("url");$.post(n,function(){})})}}}(),HomeIndexPage={Init:function(){$(".owl-carousel").owlCarousel({margin:10,loop:!0,autoWidth:!0,items:4}),$("#main").css("min-height","0")}};$().ready(function(){var n=$("#FbAppId").val();$.ajax({type:"GET",url:"https://connect.facebook.net/en_US/sdk.js",success:function(){FB.init({appId:n,version:"v3.2"}),App.Init()},dataType:"script",cache:!0})});