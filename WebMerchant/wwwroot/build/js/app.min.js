var App=function(){function n(){var e=$("#CityId").val(),i=$("#CityId").data("district");$.get(AppConstants.UrlGetDistricts(e),function(e){if(0===e.length)$(".pdistrict").hide(),$("#DistrictId").html("");else{$(".pdistrict").show();for(var n="",t=0;t<e.length;t++){var a="";i===e[t].id&&(a+="selected=selected"),n+='<option value="'+e[t].id+'" '+a+">"+e[t].name+"</option>"}$("#DistrictId").html(n)}})}return{Init:function(){var e;setTimeout(function(){AppSettings.IsAuthenticated&&(AppCommon.bindingWalletBalance(),AppNotification.Init(),2===AppSettings.CurrentUser.Type&&AppPayment.Init())},500),function(){$.notifyDefaults({placement:{from:"bottom",align:"right"}}),$('[data-toggle="tooltip"]').tooltip(),$('[data-toggle="popover"]').popover(),$(".campaign-image-carousel").owlCarousel({margin:10,items:1,autoHeight:!0}),$(".fbpost-carousel").owlCarousel({margin:10,items:4}),$(".btn-remotemodal").click(function(){var e=$(this).data("url");AppBsModal.Init(),AppBsModal.OpenRemoteModal(e,function(){})}),$(".image-upload").change(function(){var e=$(this).attr("id"),n=$(this).data("target"),t=$(this).data("preview"),a=document.getElementById(e).files;AppCommon.uploadTempImage(a,function(e){0<e.length&&($(n).val(e[0].path),$(n).trigger("change"),$(t).attr("src",e[0].url))})}),$(".form-select2").select2({theme:"bootstrap"}),$(".form-select2-tags").select2({theme:"bootstrap",tags:!0,tokenSeparators:[","]}),$(".form-datepicker").daterangepicker({singleDatePicker:!0,showDropdowns:!0,autoApply:!0,locale:{format:"DD/MM/YYYY"}}),$(".form-datetimepicker").daterangepicker({singleDatePicker:!0,timePicker:!0,autoApply:"true",showDropdowns:!0,locale:{format:"hh:mm A DD/MM/YYYY"}},function(e,n,t){moment().diff(e,"years")}),$(".form-daterangepicker").daterangepicker({autoUpdateInput:!1,locale:{format:"DD/MM/YYYY"}},function(e,n,t){moment().diff(e,"years")}),0<$("#CityId").length&&(n(),setTimeout(function(){$("#CityId").change(function(){console.log("CityId change-"),n()})},500));0<$("#cookieConsentModal").length&&$("#cookieConsentModal").modal("show");$.extend($.validator.messages,{required:"Hãy nhập dữ liệu",remote:"Hãy sửa cho đúng.",email:"Hãy nhập email.",url:"Hãy nhập URL.",date:"Hãy nhập ngày.",dateISO:"Hãy nhập ngày (ISO).",number:"Hãy nhập số.",digits:"Hãy nhập chữ số.",creditcard:"Hãy nhập số thẻ tín dụng.",equalTo:"Hãy nhập thêm lần nữa.",extension:"Phần mở rộng không đúng.",maxlength:$.validator.format("Hãy nhập từ {0} kí tự trở xuống."),minlength:$.validator.format("Hãy nhập từ {0} kí tự trở lên."),rangelength:$.validator.format("Hãy nhập từ {0} đến {1} kí tự."),range:$.validator.format("Hãy nhập từ {0} đến {1}."),max:$.validator.format("Hãy nhập từ {0} trở xuống."),min:$.validator.format("Hãy nhập từ {0} trở lên.")})}(),"campaign_create"===(e=$("#CurrentPage").val())||"campaign_editinfo"==e?CampaignCreatePage.Init():"campaign_createinfo"===e||"campaign_edittarget"===e?CampaignCreateTargetPage.Init():"campaign_details"===e?CampaignDetailsPage.Init():"campaign_index"===e?CampaignIndexPage.Init():"home_index"===e?HomeIndexPage.Init():"campaign_caption"!==e&&"campaign_content"!==e||CampaignCaptionPage.Init()}}}(),AppCommon={loadScrollTop:function(){$(window).scroll(function(){500<$(this).scrollTop()?$("#stickyFooterActions").fadeIn():$("#stickyFooterActions").fadeOut()}),$("#scrollToTop").click(function(){$("html, body").animate({scrollTop:0},800)})},handlerBtnReload:function(){$(".btn-reload").click(function(e){window.location=window.location})},uploadTempImage:function(e,n,t){var a,i;(a=new XMLHttpRequest).withCredentials=!1,a.open("POST",AppConstants.UrlUploadTempImage),a.onload=function(){if(200===a.status){var e=JSON.parse(a.responseText);n(e)}else failure("HTTP Error: "+a.status)},i=new FormData;for(var o=0;o<e.length;o++)i.append("files",e[o]);t&&i.append("sizetype",t),a.send(i)},bindingWalletBalance:function(){$.get(AppConstants.UrlGetAmount,function(e){$(".wallet-balance").html(AppCommon.moneyFormat(e)),AppSettings.CurrentUser.Balance=e})},moneyFormat:function(e,n,t){var a="\\d(?=(\\d{"+(t||3)+"})+"+(0<n?"\\.":"$")+")";return e.toFixed(Math.max(0,~~n)).replace(new RegExp(a,"g"),"$&,")+" đ"},toggleAffix:function(){function t(e,n,t){var a=e.outerHeight(),i=t.offset().top;n.scrollTop()>=i?(t.height(a),e.addClass("affix")):(e.removeClass("affix"),t.height("auto"))}$('[data-toggle="affix"]').each(function(){var e=$(this),n=$("<div></div>");e.before(n),$(window).on("scroll resize",function(){t(e,$(this),n)}),t(e,$(window),n)})}},AppConstants={UrlUploadFile:"/home/uploadimage",UrlGetAmount:"/wallet/GetAmount",UrlRecharge:function(e){return"/wallet/Recharge?campaignid="+(e=e||0)},UrlWithdraw:"/wallet/Withdraw",UrlGetNotificationCount:"/Notification/Count",UrlUpdateNotificationChecked:"/Notification/UpdateChecked",UrlGetNotification:"/Notification/IndexPartial",UrlUploadTempImage:"/Home/UploadImage",UrlGetAccounts:"/Campaign/GetAccounts",UrlGetDistricts:function(e){return"/home/GetDistricts?cityid="+e},UrlAgencyPayment:function(e){return"/Payment/CampaignPayment?campaignid="+e},ModalSpinner:'<div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="py-5 text-center text-success loading"><i class="fas fa-spinner fa-spin"></i></div> </div></div>',HtmlSpinner:'<div class="py-5 text-center text-success loading"><i class="fas fa-spinner fa-spin"></i></div>'},AppSettings={IsAuthenticated:!1,CurrentUser:{Username:"",Name:"",Type:-1,Balance:0}},AppBsModal=function(){var t="#appbsmodal";function a(){$(t).html(AppConstants.ModalSpinner),$(t).modal("show")}function i(){$(t).remove()}return{Init:function(e){i(),void 0===e&&(e=!0);var n='<div id="appbsmodal" class="modal" data-backdrop="'+e+'"></div>';$("body").append(n),$(t).on("hidden.bs.modal",function(e){i()})},OpenModal:function(e,n){$(t).html(e),n&&"function"==typeof n&&n(),$(t).modal("show")},OpenRemoteModal:function(e,n){a(),$(t).modal("show"),$.get(e,function(e){$(t).html(e),n&&"function"==typeof n&&n()})},ShowLoading:a,HideModal:function(){$(t).modal("hide"),$(t).remove()}}}(),AppNotification=function(){var a=$(".nav-notif .badge"),n=$(".nav-notif .dropdown-menu");function i(){console.log("getNotificationDropdown"),$.get(AppConstants.UrlGetNotification,function(e){n.html(e),n.find(".item-Created").each(function(){var e="notif"+$(this).data("id");if(!Cookies.get(e)){Cookies.set(e,"1");var n=$(this).html();$.notify(n)}})})}return{Init:function(){i(),$(".nav-notif").on("show.bs.dropdown",function(){$.post(AppConstants.UrlUpdateNotificationChecked,function(){$(".nav-notif .badge").hide(),$(".nav-notif .badge").text("0")})}),function n(){var t=parseInt(a.text());$.get(AppConstants.UrlGetNotificationCount,function(e){a.text(e),0===e?$(".nav-notif .badge").hide():$(".nav-notif .badge").show(),e!==t&&i(),setTimeout(function(){n()},5e3)})}()}}}(),AppPayment={Init:function(){$(".btn-payment").click(function(e){e.preventDefault();var n=$(this).data("id");AppBsModal.Init("static"),AppBsModal.OpenRemoteModal(AppConstants.UrlAgencyPayment(n))})},HandlerPayment:function(){$.validator.unobtrusive.parse($("#frmPayment")),$("#frmPayment").submit(function(e){if(e.preventDefault(),$(this).valid()){var n=$(this).data("action"),t=$(this).serialize();AppBsModal.ShowLoading(),$.post(n,t,function(e){AppBsModal.OpenModal(e)})}})},HandlerMessage:function(){AppCommon.handlerBtnReload()}},AppWallet=function(){function e(){$(".bankinfo").addClass("d-none");var e=$("#Bank").val();$("#bankinfo"+e).removeClass("d-none")}function n(){var e=$('#frmRecharge input[name="Method"]:checked').val();console.log("handlerMethod",e),"Chuyển khoản"===e?$("#bankWrap").removeClass("d-none"):$("#bankWrap").addClass("d-none")}return{Init:function(){},HandlerRecharge:function(){$.validator.unobtrusive.parse($("#frmRecharge")),$("#frmRecharge").submit(function(e){$(this).valid()&&$(this).find(".btn-submit").hide()}),n(),$('#frmRecharge input[name="Method"]').change(function(){n()}),e(),$("#Bank").change(function(){e()})},HandlerWithdraw:function(){$.validator.unobtrusive.parse($("#frmWithDraw")),$("#frmWithDraw").submit(function(e){$(this).valid()&&$(this).find(".btn-submit").hide()})}}}(),AccountIndexPage={Init:function(){FB.getLoginStatus(function(e){console.log("getLoginStatus",e),"connected"===e.status?(e.authResponse.userID,e.authResponse.accessToken,FB.api("/me?fields=friends.limit(10){id,link,name}",function(e){console.log("loadfriend",e)})):e.status})}},CampaignCaptionPage=function(){function e(){var e=".cb-checkitemChuaDuyet:checked";if(0<$(e).length){$(".frmFeedbackAll").show();var n="";$(e).each(function(){var e=$(this).val();n+='<input type="hidden" name="ids" value="'+e+'" />'}).promise().done(function(){console.log("html",n),$(".frmFeedbackAll-ids").html(n)})}else $(".frmFeedbackAll-ids").html(""),$(".frmFeedbackAll").hide()}return{Init:function(){$(".cb-checkall").click(function(){$(".cb-checkitem").prop("checked",this.checked),e()}),$(".cb-checkitem").change(function(){e()}),e()}}}(),CampaignCreatePage=function(){function e(n){var e=$("#frmCreateCampaign");if(console.log("createCampaign"),e.valid()){AppBsModal.Init("static"),AppBsModal.ShowLoading();var t=e.data("action"),a=e.serialize();$.post(t,a,function(e){-1==e.status?(AppBsModal.HideModal(),$.notify({message:e.message,type:"danger"})):n(e)})}}function n(){$(".reviewaddress-container").hide();var e=$("input[name=ReviewType]:checked").val();console.log("handlerReviewType",e),e&&$(".reviewaddress-container-"+e).show()}function t(){$(".form-reviewAddress").hide();var e=$("input[name=ReviewPayback]:checked").val();console.log("handlerReviewPayback",e),e?$(".form-reviewAddress").show():$(".form-reviewAddress").hide()}function c(){var e=$("input[name=AccountType]:checked").val();console.log("accouttype",e),"Regular"===e?($(".d-withoutRegular").hide(),$(".d-withRegular").show()):"HotMom"===e?($(".d-withoutHotMom").addClass("d-none"),$(".d-withHotMom").removeClass("d-none")):$(".d-withRegular").hide()}function a(){"OpenJoined"==$("input[name=Method]:checked").val()?($(".d-withoutOpenJoined").addClass("d-none"),$("#actionWrap").removeClass("d-none")):$(".d-withoutOpenJoined").removeClass("d-none")}function i(){var e=$("#Type").val();console.log("type",e),$("#enabledExtraTypeWrap,#requirementWrap,#changeAvatarWrap").addClass("d-none"),$(".d-type").hide(),$(".d-type-"+e).show();var n=$("#Type").children("option:selected"),t=n.data("accountpricetext"),a=n.data("datatext");$("#dataText").text(a),"ChangeAvatar"===e?($("#dataInput").addClass("d-none"),$("#dataImage").removeClass("d-none")):($("#dataInput").removeClass("d-none"),$("#dataImage").addClass("d-none")),$("#editAccountPriceWrap span").text(t),$("#editAccountPriceWrap").removeClass("openedit"),"ShareContent"===e||"ShareContentWithCaption"===e?$("#enabledExtraTypeWrap").removeClass("d-none"):"CustomService"===e?($("#requirementWrap").removeClass("d-none"),$("#editAccountPriceWrap").addClass("openedit")):"JoinEvent"===e?$("#editAccountPriceWrap").addClass("openedit"):"ChangeAvatar"===e&&$("#changeAvatarWrap").removeClass("d-none"),o()}function o(){$("#btnCreateCampaign").show()}return{Init:function(){$("#dataImageFile").change(function(){var e=$(this).attr("id"),n=$(this).data("target"),t=$(this).data("preview"),a=$(this).data("sizetype"),i=document.getElementById(e).files;AppCommon.uploadTempImage(i,function(e){0<e.length&&($(n).val(e[0].path),$(n).trigger("change"),$(t).attr("src",e[0].url))},a)}),$("#addonImages").change(function(){var e=$(this).attr("id"),t=$(this).data("target"),n=document.getElementById(e).files;AppCommon.uploadTempImage(n,function(e){e.forEach(function(e){var n='<div class="addonimage"><span class="remove"><i class="fal fa-times"></i></span> <img src="'+e.url+'" id="imagePreview" class="img-thumbnail mt-2" style="" /><input type="hidden" name="AddonImages" value="'+e.path+'" /></div>';$(t).append(n)}),$(".addonimage .remove").unbind("click"),$(".addonimage .remove").click(function(){$(this).closest(".addonimage").remove()})})}),$("#sampleContent").change(function(){var e=$(this).attr("id"),t=$(this).data("target"),n=document.getElementById(e).files;AppCommon.uploadTempImage(n,function(e){e.forEach(function(e){var n='<div class="addonimage"><span class="remove"><i class="fal fa-times"></i></span> <img src="'+e.url+'" class="img-thumbnail mt-2" style="" /><input type="hidden" name="SampleContent" value="'+e.path+'" /></div>';$(t).append(n)}),$(".addonimage .remove").unbind("click"),$(".addonimage .remove").click(function(){$(this).closest(".addonimage").remove()})})}),$("#btnCreateCampaign").click(function(){$("#submittype").val(1),e(function(e){setTimeout(function(){window.location=e.url},1e3)})}),$("#btnCreateCampaignRecharge").click(function(){$("#submittype").val(0),e(function(e){AppBsModal.OpenRemoteModal(AppConstants.UrlRecharge(e.campaignid),function(){AppWallet.HandlerRecharge()})})}),i(),$("#Type").change(function(){i()}),c(),$("input[name=AccountType]").change(function(){c()}),a(),$("input[name=Method]").change(function(){a()}),$("#campaignOptions .form-option").change(function(){o()}),$(".btn-suggestaccount").click(function(){!function(){var e=$("#suggestAccount").data("url"),n="",t=$("input[name=AccountType]:checked").val();n+="&accountTypes="+t,"true"===$("input[name=EnabledGender]:checked").val()&&(n+="&gender="+$("input[name=Gender]:checked").val());"true"===$("input[name=EnabledAgeRange]:checked").val()&&(n+="&agestart="+$("#AgeStart").val()+"&ageend="+$("#AgeEnd").val());if("true"===$("input[name=EnabledCity]:checked").val()){var a=$("#CityId").val();console.log("cityids",a);for(var i=0;i<a.length;i++)n+="&cityid="+a[i]}if("true"===$("input[name=EnabledCategory]:checked").val()){var o=$("#CategoryId").val();for(i=0;i<o.length;i++)n+="&categoryid="+o[i]}n+="&pagesize="+$("#Quantity").val(),n+="&campaignType="+$("#Type").val(),n+="&min="+$("#amountMin").val(),n+="&max="+$("#amountMax").val(),console.log("urlparams",n),$("#suggestAccount").html(AppConstants.HtmlSpinner),$.get(e+"?"+n,function(e){$("#suggestAccount").html(e),function t(){var a=$("#tblMatchedAccounts").data("renewurl");$(".btn-renewaccount").unbind("click");$(".btn-renewaccount").click(function(){var n=$(this).closest("tr"),e="";$(".form-accountid").each(function(){e+="&ignoreids="+$(this).val()}).promise().done(function(){$.get(a+e,function(e){e.length<100?$.notify("Hệ thóng không có thành viên khác phù hợp các tiêu chí"):(n.replaceWith(e),t())})})});$(".btn-removeaccount").unbind("click");$(".btn-removeaccount").click(function(){var e=$(this).closest("tr");e.remove()});c()}()})}()}),$("#HashTag").select2({maximumSelectionLength:3,theme:"bootstrap",tags:!0}),$("#CustomKolNames").select2({theme:"bootstrap4",ajax:{url:AppConstants.UrlGetAccounts,data:function(e){var n=$("input[name=AccountType]:checked").val();return{kw:e.term,type:n}},dataType:"json",processResults:function(e){return{results:$.map(e,function(e){return{text:e.name,id:e.id}})}}}}),c(),$("#SendProduct").change(function(){$(this).is(":checked")&&$("#modal-timereview").modal("show")}),0<$(".reviewaddress-container").length&&(n(),$("input[name=ReviewType]").change(function(){n()}),$("#ReviewDate").daterangepicker({timePicker:!0,minDate:moment(),startDate:moment(),endDate:moment().startOf("hour").add(10,"hour"),locale:{format:"hh:mm A DD/MM/YYYY"},parentEl:""}),t(),$("input[name=ReviewPayback]").change(function(){t()}))}}}(),CampaignCreateTargetPage=function(){function t(e){0<e.find(".cb-checkitem:checked").length?$("#btn-submitInfluencer").show():$("#btn-submitInfluencer").hide()}function e(){var e=$("input[name=AccountType]:checked").val();console.log("accouttype",e),$(".d-accounttype").hide(),$(".d-accounttype-"+e).show(),$(".h-accounttype").show(),$(".h-accounttype-"+e).hide()}return{Init:function(){$("#CategoryId").select2({maximumSelectionLength:3,theme:"bootstrap"}),$("#FeedbackBefore").daterangepicker({timePicker:!0,minDate:moment(),startDate:moment(),endDate:moment().startOf("hour").add(10,"hour"),locale:{format:"hh:mm A DD/MM/YYYY"}}),$("#RegisterTime").daterangepicker({timePicker:!0,minDate:moment(),startDate:moment(),endDate:moment().startOf("hour").add(10,"hour"),locale:{format:"hh:mm A DD/MM/YYYY"}}),$("#ExecutionTime").daterangepicker({timePicker:!0,minDate:moment(),startDate:moment(),endDate:moment().startOf("hour").add(10,"hour"),locale:{format:"hh:mm A DD/MM/YYYY"}}),$("#FeedbackBefore2").daterangepicker({timePicker:!0,locale:{format:"hh:mm A DD/MM/YYYY"}}),$("#RegisterTime2").daterangepicker({timePicker:!0,locale:{format:"hh:mm A DD/MM/YYYY"}}),$("#ExecutionTime2").daterangepicker({timePicker:!0,locale:{format:"hh:mm A DD/MM/YYYY"}}),$("#AmountMin").change(function(){var e=$("#AmountMin").val();console.log("amount min",e),$("#AmountMax").val()<e&&$("#AmountMax").val(e),$("#AmountMax").attr("min",e)}),e(),$("input[name=AccountType]").change(function(){e()}),$("#modal-influencer-selection").on("shown.bs.modal",function(e){$("#modal-influencer-selection .frm-search").submit()}),$("#modal-influencer-selection .frm-search").submit(function(){var e=$(this).data("action"),n=$(this).serialize(0);$("#list-influencer").html(AppConstants.HtmlSpinner),$.post(e,n,function(e){$("#list-influencer").html(e),function(){var e=$("#list-influencer");e.find(".cb-checkall").click(function(){$(".cb-checkitem").prop("checked",this.checked),t(e)}),e.find(".cb-checkitem").change(function(){t(e)});var n=$("#btn-submitInfluencer");n.hide(),n.unbind("click"),n.click(function(){var n="";$("#list-influencer .cb-checkitem:checked").each(function(){var e=$(this).val();n+='<span><input type="hidden" name="AccountIds" value="'+e+'" /></span>'}).promise().done(function(){console.log("html",n),$("#AccountIdsArea").append(n),$(".badge-influencer-count").html($("#AccountIdsArea span").length),$("#modal-influencer-selection").modal("hide")})})}()})}),console.log("CampaignCreateTargetPage")}}}(),CampaignDetailsPage=function(){function o(n){$(".btn-reload").unbind("click"),$(".btn-reload").click(function(e){n?window.location=window.location:AppBsModal.HideModal()})}return{Init:function(){CampaignIndexPage.Init(),$(".btn-campaignaccount").click(function(){var e=$(this).data("url");AppBsModal.Init("static"),AppBsModal.OpenRemoteModal(e,function(){$(".frm-requestjoin").submit(function(){var e=$(this),n=e.serialize(),t=e.data("action"),a=e.find(".btn-requestjoin"),i=a.find("i");a.prop("disabled",!0),i.removeClass("fa-plus").addClass("fa-spinner fa-spin"),$.post(t,n,function(e){1==e?(a.removeClass("btn-outline-primary").addClass("btn-outline-success"),i.removeClass("fa-spinner fa-spin").addClass("fa-check")):(a.prop("disabled",!1),a.removeClass("btn-outline-primary").addClass("btn-outline-danger"),i.removeClass("fa-spinner fa-spin").addClass("fa-plus")),o(!0)})}),o()})})}}}(),CampaignIndexPage=function(){function n(e){console.log("$target2",e);var n=".cb-checkitemAccountRequest:checked";if(0<e.find(n).length){e.find(".frmFeedbackAll").show();var t="";e.find(n).each(function(){var e=$(this).val();t+='<input type="hidden" name="accountid" value="'+e+'" />'}).promise().done(function(){console.log("html",t),e.find(".frmFeedbackAll-ids").html(t)})}else e.find(".frmFeedbackAll-ids").html(""),e.find(".frmFeedbackAll").hide()}function i(n,e){e=e||n.data("url");console.log("url",e),n.html(AppConstants.HtmlSpinner),$.get(e,function(e){n.html(e),o(n)})}function o(t){var a,e;e=(a=t).find(".frmFeedback"),$(":submit",e).click(function(){$(this).attr("name")&&$(e).append($("<input type='hidden'>").attr({name:$(this).attr("name"),value:$(this).attr("value")}))}),$(e).submit(function(e){console.log("submit"),e.preventDefault(),a.html(AppConstants.HtmlSpinner);var n=$(this).data("action");console.log("handlerAccountCampaign",n);var t=$(this).serialize();$.post(n,t,function(e){a.html(e),o(a)})}),t.find(".page-link").click(function(e){e.preventDefault();var n=$(this).attr("href");i(t,n)}),t.find(".cb-checkall").click(function(){$(".cb-checkitem").prop("checked",this.checked),n(t)}),t.find(".cb-checkitem").change(function(){n(t)}),n(t)}return{Init:function(){$(".modal-accountcampaign").on("hidden.bs.modal",function(){$(this).find(".list-campaignaccount").html("")}),$(".modal-accountcampaign").on("shown.bs.modal",function(){var n=$(this);i(n.find(".list-campaignaccount")),n.find('a[data-toggle="tab"]').on("shown.bs.tab",function(e){1==$(e.target).data("type")?i(n.find(".list-campaignaccount")):i(n.find(".list-matchedaccount"))})})}}}(),ChangeAccountTypePage=function(){function e(){"HotMom"===$("input[name=Type]:checked").val()?$("#dataHotMom").removeClass("d-none"):$("#dataHotMom").addClass("d-none")}return{Init:function(){e(),$("input[name=Type]").change(function(){e()}),$(".checkbox-ignorecampaigntype").change(function(){var e=$(this).data("url");$.post(e,function(){})})}}}(),HomeIndexPage={Init:function(){}};$().ready(function(){App.Init()});