var App=function(){function n(){var t=$("#CityId").val(),o=$("#CityId").data("district");$.get(AppConstants.UrlGetDistricts(t),function(t){if(0===t.length)$(".pdistrict").hide(),$("#DistrictId").html("");else{$(".pdistrict").show();for(var n="",e=0;e<t.length;e++){var a="";o===t[e].id&&(a+="selected=selected"),n+='<option value="'+t[e].id+'" '+a+">"+t[e].name+"</option>"}$("#DistrictId").html(n)}})}return{Init:function(){var t;setTimeout(function(){AppSettings.IsAuthenticated&&(AppCommon.bindingWalletBalance(),AppNotification.Init())},500),function(){$('[data-toggle="tooltip"]').tooltip(),$(".campaign-image-carousel").owlCarousel({margin:10,items:1,autoHeight:!0}),$(".fbpost-carousel").owlCarousel({margin:10,items:4}),$(".btn-remotemodal").click(function(){var t=$(this).data("url");AppBsModal.Init(),AppBsModal.OpenRemoteModal(t,function(){})}),$(".image-upload").change(function(){var t=$(this).attr("id"),n=$(this).data("target"),e=$(this).data("preview"),a=document.getElementById(t).files;AppCommon.uploadTempImage(a,function(t){0<t.length&&($(n).val(t[0].path),$(n).trigger("change"),$(e).attr("src",t[0].url))})}),$(".form-select2").select2({theme:"bootstrap"}),$(".form-select2-tags").select2({theme:"bootstrap",tags:!0,tokenSeparators:[","]}),$(".form-datepicker").daterangepicker({singleDatePicker:!0,showDropdowns:!0,autoApply:!0,locale:{format:"DD/MM/YYYY"}}),$(".form-datetimepicker").daterangepicker({singleDatePicker:!0,timePicker:!0,autoApply:"true",showDropdowns:!0,locale:{format:"hh:mm A DD/MM/YYYY"}},function(t,n,e){moment().diff(t,"years")}),$(".form-daterangepicker").daterangepicker({autoUpdateInput:!1,locale:{format:"DD/MM/YYYY"}},function(t,n,e){moment().diff(t,"years")}),0<$("#CityId").length&&(n(),setTimeout(function(){$("#CityId").change(function(){console.log("CityId change-"),n()})},500));0<$("#cookieConsentModal").length&&$("#cookieConsentModal").modal("show");$.extend($.validator.messages,{required:"Hãy nhập.",remote:"Hãy sửa cho đúng.",email:"Hãy nhập email.",url:"Hãy nhập URL.",date:"Hãy nhập ngày.",dateISO:"Hãy nhập ngày (ISO).",number:"Hãy nhập số.",digits:"Hãy nhập chữ số.",creditcard:"Hãy nhập số thẻ tín dụng.",equalTo:"Hãy nhập thêm lần nữa.",extension:"Phần mở rộng không đúng.",maxlength:$.validator.format("Hãy nhập từ {0} kí tự trở xuống."),minlength:$.validator.format("Hãy nhập từ {0} kí tự trở lên."),rangelength:$.validator.format("Hãy nhập từ {0} đến {1} kí tự."),range:$.validator.format("Hãy nhập từ {0} đến {1}."),max:$.validator.format("Hãy nhập từ {0} trở xuống."),min:$.validator.format("Hãy nhập từ {0} trở lên.")})}(),"campaign_create"===(t=$("#CurrentPage").val())?CampaignCreatePage.Init():"campaign_createinfo"===t?CampaignCreateTargetPage.Init():"campaign_details"===t?DetailsCampaignPage.Init():"home_index"===t&&HomeIndexPage.Init()}}}(),AppCommon={loadScrollTop:function(){$(window).scroll(function(){500<$(this).scrollTop()?$("#stickyFooterActions").fadeIn():$("#stickyFooterActions").fadeOut()}),$("#scrollToTop").click(function(){$("html, body").animate({scrollTop:0},800)})},handlerBtnReload:function(){$(".btn-reload").click(function(t){window.location=window.location})},uploadTempImage:function(t,n){var e,a;(e=new XMLHttpRequest).withCredentials=!1,e.open("POST",AppConstants.UrlUploadTempImage),e.onload=function(){if(200===e.status){var t=JSON.parse(e.responseText);n(t)}else failure("HTTP Error: "+e.status)},a=new FormData;for(var o=0;o<t.length;o++)a.append("files",t[o]);e.send(a)},bindingWalletBalance:function(){$.get(AppConstants.UrlGetAmount,function(t){$(".wallet-balance").html(AppCommon.moneyFormat(t)),AppSettings.CurrentUser.Balance=t})},moneyFormat:function(t,n,e){var a="\\d(?=(\\d{"+(e||3)+"})+"+(0<n?"\\.":"$")+")";return t.toFixed(Math.max(0,~~n)).replace(new RegExp(a,"g"),"$&,")+" đ"},toggleAffix:function(){function e(t,n,e){var a=t.outerHeight(),o=e.offset().top;n.scrollTop()>=o?(e.height(a),t.addClass("affix")):(t.removeClass("affix"),e.height("auto"))}$('[data-toggle="affix"]').each(function(){var t=$(this),n=$("<div></div>");t.before(n),$(window).on("scroll resize",function(){e(t,$(this),n)}),e(t,$(window),n)})}},AppConstants={UrlUploadFile:"/home/uploadimage",UrlGetAmount:"/wallet/GetAmount",UrlRecharge:function(t){return"/wallet/Recharge?campaignid="+(t=t||0)},UrlWithdraw:"/wallet/Withdraw",UrlGetNotificationCount:"/Notification/Count",UrlUpdateNotificationChecked:"/Notification/UpdateChecked",UrlGetNotification:"/Notification/IndexPartial",UrlUploadTempImage:"/Home/UploadImage",UrlGetAccounts:"/Campaign/GetAccounts",UrlGetDistricts:function(t){return"/home/GetDistricts?cityid="+t},UrlAgencyPayment:function(t){return"/AgencyPayment/CampaignPayment?campaignid="+t},ModalSpinner:'<div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="py-5 text-center text-success loading"><i class="fas fa-spinner fa-spin"></i></div> </div></div>',HtmlSpinner:'<div class="py-5 text-center text-success loading"><i class="fas fa-spinner fa-spin"></i></div>'},AppSettings={IsAuthenticated:!1,CurrentUser:{Username:"",Name:"",Type:-1,Balance:0}},AppBsModal=function(){var e="#appbsmodal";function a(){$(e).html(AppConstants.ModalSpinner),$(e).modal("show")}function o(){$(e).remove()}return{Init:function(t){o(),void 0===t&&(t=!0);var n='<div id="appbsmodal" class="modal" data-backdrop="'+t+'"></div>';$("body").append(n),$(e).on("hidden.bs.modal",function(t){o()})},OpenModal:function(t,n){$(e).html(t),n&&"function"==typeof n&&n(),$(e).modal("show")},OpenRemoteModal:function(t,n){a(),$(e).modal("show"),$.get(t,function(t){$(e).html(t),n&&"function"==typeof n&&n()})},ShowLoading:a,HideModal:function(){$(e).modal("hide"),$(e).remove()}}}(),AppNotification=function(){var e=$(".nav-notif .badge"),n=$(".nav-notif .dropdown-menu");function a(){$.get(AppConstants.UrlGetNotification,function(t){n.html(t)})}return{Init:function(){var n;a(),$(".nav-notif").on("show.bs.dropdown",function(){$.post(AppConstants.UrlUpdateNotificationChecked,function(){$(".nav-notif .badge").hide(),$(".nav-notif .badge").text("0")})}),n=parseInt(e.text()),$.get(AppConstants.UrlGetNotificationCount,function(t){e.text(t),0===t?$(".nav-notif .badge").hide():$(".nav-notif .badge").show(),t!==n&&a()})}}}(),AppPayment={Init:function(){$(".btn-payment").click(function(t){t.preventDefault();var n=$(this).data("id");AppBsModal.Init("static"),AppBsModal.OpenRemoteModal(AppConstants.UrlAgencyPayment(n))})},HandlerPayment:function(){$.validator.unobtrusive.parse($("#frmPayment")),$("#frmPayment").submit(function(t){if(t.preventDefault(),$(this).valid()){var n=$(this).data("action"),e=$(this).serialize();AppBsModal.ShowLoading(),$.post(n,e,function(t){AppBsModal.OpenModal(t)})}})},HandlerMessage:function(){AppCommon.handlerBtnReload()}},AppWallet=function(){function t(){$(".bankinfo").addClass("d-none");var t=$("#Bank").val();$("#bankinfo"+t).removeClass("d-none")}function n(){var t=$('#frmRecharge input[name="Method"]:checked').val();console.log("handlerMethod",t),"Chuyển khoản"===t?$("#bankWrap").removeClass("d-none"):$("#bankWrap").addClass("d-none")}return{Init:function(){},HandlerRecharge:function(){$.validator.unobtrusive.parse($("#frmRecharge")),$("#frmRecharge").submit(function(t){$(this).valid()&&$(this).find(".btn-submit").hide()}),n(),$('#frmRecharge input[name="Method"]').change(function(){n()}),t(),$("#Bank").change(function(){t()})},HandlerWithdraw:function(){$.validator.unobtrusive.parse($("#frmWithDraw")),$("#frmWithDraw").submit(function(t){$(this).valid()&&$(this).find(".btn-submit").hide()})}}}(),AccountIndexPage={Init:function(){FB.getLoginStatus(function(t){console.log("getLoginStatus",t),"connected"===t.status?(t.authResponse.userID,t.authResponse.accessToken,FB.api("/me?fields=friends.limit(10){id,link,name}",function(t){console.log("loadfriend",t)})):t.status})}},AgencyDetailsCampaignPage=function(){function i(n){$(".btn-reload").unbind("click"),$(".btn-reload").click(function(t){n?window.location=window.location:AppBsModal.HideModal()})}return{Init:function(){$(".btn-campaignaccount").click(function(){var t=$(this).data("url");AppBsModal.Init("static"),AppBsModal.OpenRemoteModal(t,function(){$(".frm-requestjoin").submit(function(){var t=$(this),n=t.serialize(),e=t.data("action"),a=t.find(".btn-requestjoin"),o=a.find("i");a.prop("disabled",!0),o.removeClass("fa-plus").addClass("fa-spinner fa-spin"),$.post(e,n,function(t){1==t?(a.removeClass("btn-outline-primary").addClass("btn-outline-success"),o.removeClass("fa-spinner fa-spin").addClass("fa-check")):(a.prop("disabled",!1),a.removeClass("btn-outline-primary").addClass("btn-outline-danger"),o.removeClass("fa-spinner fa-spin").addClass("fa-plus")),i(!0)})}),i()})})}}}(),CampaignCreatePage=function(){function t(n){var t=$("#frmCreateCampaign");if(console.log("createCampaign"),t.valid()){AppBsModal.Init("static"),AppBsModal.ShowLoading();var e=t.data("action"),a=t.serialize();$.post(e,a,function(t){-1==t.status?(AppBsModal.HideModal(),$.notify({message:t.message,type:"danger"})):n(t)})}}function c(){var t=$("input[name=AccountType]:checked").val();console.log("accouttype",t),"Regular"===t?($(".d-withoutRegular").hide(),$(".d-withRegular").show()):"HotMom"===t?($(".d-withoutHotMom").addClass("d-none"),$(".d-withHotMom").removeClass("d-none")):$(".d-withRegular").hide()}function n(){"OpenJoined"==$("input[name=Method]:checked").val()?($(".d-withoutOpenJoined").addClass("d-none"),$("#actionWrap").removeClass("d-none")):$(".d-withoutOpenJoined").removeClass("d-none")}function e(){var t=$("#Type").val();console.log("type",t),$("#enabledExtraTypeWrap,#requirementWrap,#changeAvatarWrap").addClass("d-none"),$(".d-type").hide(),$(".d-type-"+t).show();var n=$("#Type").children("option:selected"),e=n.data("accountpricetext"),a=n.data("datatext");$("#dataText").text(a),"ChangeAvatar"===t?($("#dataInput").addClass("d-none"),$("#dataImage").removeClass("d-none")):($("#dataInput").removeClass("d-none"),$("#dataImage").addClass("d-none")),$("#editAccountPriceWrap span").text(e),$("#editAccountPriceWrap").removeClass("openedit"),"ShareContent"===t||"ShareContentWithCaption"===t?$("#enabledExtraTypeWrap").removeClass("d-none"):"CustomService"===t?($("#requirementWrap").removeClass("d-none"),$("#editAccountPriceWrap").addClass("openedit")):"JoinEvent"===t?$("#editAccountPriceWrap").addClass("openedit"):"ChangeAvatar"===t&&$("#changeAvatarWrap").removeClass("d-none"),o()}function o(){$("#btnCreateCampaign").show()}return{Init:function(){$("#dataImageFile").change(function(){var t=$(this).attr("id"),n=$(this).data("target"),e=$(this).data("preview"),a=document.getElementById(t).files;AppCommon.uploadTempImage(a,function(t){0<t.length&&($(n).val(t[0].path),$(n).trigger("change"),$(e).attr("src",t[0].url))})}),$("#addonImages").change(function(){var t=$(this).attr("id"),e=$(this).data("target"),n=document.getElementById(t).files;AppCommon.uploadTempImage(n,function(t){t.forEach(function(t){var n='<div class="addonimage"><span class="remove"><i class="fal fa-times"></i></span> <img src="'+t.url+'" id="imagePreview" class="img-thumbnail mt-2" style="" /><input type="hidden" name="AddonImages" value="'+t.path+'" /></div>';$(e).append(n)}),$(".addonimage .remove").unbind("click"),$(".addonimage .remove").click(function(){$(this).closest(".addonimage").remove()})})}),$("#sampleContent").change(function(){var t=$(this).attr("id"),e=$(this).data("target"),n=document.getElementById(t).files;AppCommon.uploadTempImage(n,function(t){t.forEach(function(t){var n='<div class="addonimage"><span class="remove"><i class="fal fa-times"></i></span> <img src="'+t.url+'" class="img-thumbnail mt-2" style="" /><input type="hidden" name="SampleContent" value="'+t.path+'" /></div>';$(e).append(n)}),$(".addonimage .remove").unbind("click"),$(".addonimage .remove").click(function(){$(this).closest(".addonimage").remove()})})}),$("#btnCreateCampaign").click(function(){$("#submittype").val(1),t(function(t){setTimeout(function(){window.location=t.url},1e3)})}),$("#btnCreateCampaignRecharge").click(function(){$("#submittype").val(0),t(function(t){AppBsModal.OpenRemoteModal(AppConstants.UrlRecharge(t.campaignid),function(){AppWallet.HandlerRecharge()})})}),e(),$("#Type").change(function(){e()}),c(),$("input[name=AccountType]").change(function(){c()}),n(),$("input[name=Method]").change(function(){n()}),$("#campaignOptions .form-option").change(function(){o()}),$(".btn-suggestaccount").click(function(){!function(){var t=$("#suggestAccount").data("url"),n="",e=$("input[name=AccountType]:checked").val();n+="&accountTypes="+e,"true"===$("input[name=EnabledGender]:checked").val()&&(n+="&gender="+$("input[name=Gender]:checked").val());"true"===$("input[name=EnabledAgeRange]:checked").val()&&(n+="&agestart="+$("#AgeStart").val()+"&ageend="+$("#AgeEnd").val());if("true"===$("input[name=EnabledCity]:checked").val()){var a=$("#CityId").val();console.log("cityids",a);for(var o=0;o<a.length;o++)n+="&cityid="+a[o]}if("true"===$("input[name=EnabledCategory]:checked").val()){var i=$("#CategoryId").val();for(o=0;o<i.length;o++)n+="&categoryid="+i[o]}n+="&pagesize="+$("#Quantity").val(),n+="&campaignType="+$("#Type").val(),n+="&min="+$("#amountMin").val(),n+="&max="+$("#amountMax").val(),console.log("urlparams",n),$("#suggestAccount").html(AppConstants.HtmlSpinner),$.get(t+"?"+n,function(t){$("#suggestAccount").html(t),function e(){var a=$("#tblMatchedAccounts").data("renewurl");$(".btn-renewaccount").unbind("click");$(".btn-renewaccount").click(function(){var n=$(this).closest("tr"),t="";$(".form-accountid").each(function(){t+="&ignoreids="+$(this).val()}).promise().done(function(){$.get(a+t,function(t){t.length<100?$.notify("Hệ thóng không có thành viên khác phù hợp các tiêu chí"):(n.replaceWith(t),e())})})});$(".btn-removeaccount").unbind("click");$(".btn-removeaccount").click(function(){var t=$(this).closest("tr");t.remove()});c()}()})}()}),$("#HashTag").select2({maximumSelectionLength:3,theme:"bootstrap",tags:!0}),$("#CustomKolNames").select2({theme:"bootstrap4",ajax:{url:AppConstants.UrlGetAccounts,data:function(t){var n=$("input[name=AccountType]:checked").val();return{kw:t.term,type:n}},dataType:"json",processResults:function(t){return{results:$.map(t,function(t){return{text:t.name,id:t.id}})}}}}),c()}}}(),CampaignCreateTargetPage=function(){function t(){var t=$("input[name=AccountType]:checked").val();console.log("accouttype",t),$(".d-accounttype").hide(),$(".d-accounttype-"+t).show(),$(".h-accounttype").show(),$(".h-accounttype-"+t).hide()}return{Init:function(){$("#CategoryId").select2({maximumSelectionLength:3,theme:"bootstrap"}),$("#RegisterTime").daterangepicker({timePicker:!0,minDate:moment(),startDate:moment(),endDate:moment().startOf("hour").add(10,"hour"),locale:{format:"hh:mm A DD/MM/YYYY"}}),$("#FeedbackBefore").daterangepicker({timePicker:!0,minDate:moment(),startDate:moment(),endDate:moment().startOf("hour").add(10,"hour"),locale:{format:"hh:mm A DD/MM/YYYY"}}),$("#ExecutionTime").daterangepicker({timePicker:!0,minDate:moment(),startDate:moment(),endDate:moment().startOf("hour").add(10,"hour"),locale:{format:"hh:mm A DD/MM/YYYY"}}),$("#AccountIds").select2({theme:"bootstrap",ajax:{url:AppConstants.UrlGetAccounts,data:function(t){var n=$("input[name=AccountType]:checked").val();return{kw:t.term,type:n}},dataType:"json",processResults:function(t){return{results:$.map(t,function(t){return{text:t.name,id:t.id}})}}}}),t(),$("input[name=AccountType]").change(function(){t()})}}}(),ChangeAccountTypePage=function(){function t(){"HotMom"===$("input[name=Type]:checked").val()?$("#dataHotMom").removeClass("d-none"):$("#dataHotMom").addClass("d-none")}return{Init:function(){t(),$("input[name=Type]").change(function(){t()}),$(".checkbox-ignorecampaigntype").change(function(){var t=$(this).data("url");$.post(t,function(){})})}}}(),HomeIndexPage={Init:function(){}};$().ready(function(){App.Init()});